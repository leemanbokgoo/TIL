# ACID
- ACID(원자성, 일관성, 고립성, 지속성)는 데이터베이스 트랜잭션이 안전하게 수행된다는 것을 보장하기 위한 성질을 가리키는 약어이다.
- 트랜잭션이라는 것은 데이터베이스 내에 서 하나의 논리적 기능을 수행하기 위해 행해지는 작업의 단위 또는 한번에 사용되는 하나 이상의 쿼리를 모아 놓은 쪼갤 수 없는 작업의 논리적인 단위이다. 트랜젝션은 ACID를 만족해야한다. ACID는 원자성(Atomicity), 일관성(Consistency), 고립성(Isolation) 그리고 지속성(Durability)의 약자이다.

## 원자성(Atomicity)
- 트랜젝션은 분해가 불가능한 최소의 단위인 하나의 원자처럼 동작한다는 의미. 트랜젝션 내의 모든 연산들은 반드시 한꺼번에 완전하게 전체가 정상적으로 수행이 완료되거나 아니면 어떠한 연산도 수행되지 않은 all or noting.
- 성공 시 커밋했을 때 DB에 영구적으로 저장하는 것과 실패 시 롤백했을 때 이전 상태로 되돌리는 것은 DBMS가 담당하는 부분이다. 개발자는 언제 커밋하고 언제 롤백할 지에 대한 기준을 세우고 코드를 작성해야 한다.
- 예를 들어 티스토리 게시판에 글을 작성한다. 트랜잭션의 Atomicity가 보장 된다는 것은 티스토리 데이터 베이스에 성공적으로 저장되거나, 실패하거나 2가지 경우밖에 없다는 것이다. 글 내용의 절반만 저장되고 나머지는 저장안되는 경우를 없게 한다는 것이다.

## 일관성(Consistency)
- 트랜잭션 작업이 시작되기 전에 데이터베이스 상태가 일관된 상태였다면 트랜잭션 작업이 종료된 후에도 일관성 있는 데이터 베이스 상태를 유지해아한다.
- 예를 들어서 티스토리 게시판에 글을 쓰는데 제목의 글자 제한이 255자라고 하자. 트랜잭션이 일어나면 이러한 조건을 만족해야하는 것이다. 만약 이를 위반하는 트랜잭션이 있다면 거부해야한다.
- 만약에, constraints, trigger 등을 통해서 DB에 정의된 규칙을 트랜잭션이 위반했다면 롤백해야 한다. 예를 들어, 계좌에 잔액을 업데이트하는 트랜잭션 결과로 잔액이 마이너스로 가버렸다면 그냥 롤백해야 한다.
- 트랜잭션이 DB에 정의된 규칙을 위반했는지는 DBMS가 커밋 전에 확인하고 알려준다. 그렇다고 DBMS를 맹신하기보다는, 애플리케이션 관점에서 트랜잭션이 consistent하게 동작하는지는 개발자도 챙겨야 한다. 
- 일관성은 트랜잭션 전후에 데이터가 항상 정해진 규칙(제약조건, 무결성 등)을 지켜야 한다는 개념이다. 예를 들어 은행 이체에서 돈이 한쪽에서 빠졌는데 다른 쪽에 반영되지 않는다면 일관성이 깨진 상태이다. 따라서 트랜잭션 실행 전과 후에 데이터가 무결하게 유지되어야 일관성이 있다고 말할 수 있다.

## 고립성(Isolation)
- 트랜잭션 작업 수행 중에는 다른 트랜잭션에 영향을 주어서도 안되고, 다른 트랜잭션들에 의해 간섭을 받아서도 안 된다는 것을 의미. 다른 트랜잭션의 영향을 받게 되면 영향을 주는 트랜잭션에 의해 자신의 동작이 달라 질 수 있기 때문에, 트랜젝션 자신은 고립된 상태에서 수행되어야 한다는 것을 의미. 즉 다수의 트랜잭션이 동시에 수행중인 상황에서 하나의 트랜잭션이 완료될 때까지는 현재 실행 중인 트랜잭션의 중간 수행결과를 다른 트랜잭션에서 보거나 참조 할 수 없다.
- 예를 들어서 모 커뮤니티의 자유게시판에 두 사람이 글을 거의 동시에 올린다고 하자. 그러면 두 트랜젝션에 충돌이 일어나서 User A의 제목이 저장되고 내용은 User B가 저장되는게 아니라 User A의 트랜잭션이 종료 되기 전까지 User B의 트랜젝션은 실행되지 않는 것을 말한다.
- DBMS는 여러 종류의 isolation level을 제공하고, 개발자는 이중에서 어떤 레벨로 트랜잭션을 동작시킬지 설정할 수 있다. 여러 트랜잭션이 동시에 실행되었을 때, 결과가 이상해지는 문제가 발생할 수 있다. 

## 지속성(Durablility)
- 일련의 데이터 조작(트렌젝션 조작)을 완료 하고 완료 통지를 사용자가 받는 시점에서 그 조작이 영구적이 되어 그 결과를 잃지 않는 것을 나타낸다. 시스템이 정상일 때 뿐 아니라 데이터베이스나 OS의 이상 종료, 즉 시스템 장애도 견딜 수 있다는 것을 말한다. MySQL을 포함해 많은 데이터베이스의 구현에서는 트랜젝션 조작을 하드 디스크에 로그로 기록하고 시스템에 이상이 발생하면 그 로그를 사용해 이상 발생 전까지 복원하는 것으로 지속성을 실현하고 있다.
- 다시 말해, 트랜잭션이 완료되면 결과는 데이터베이스에 영구적으로 저장되며, 이후 시스템에 어떠한 문제가 생기더라도 데이터는 손상되지 않는다.
- 지속성(Durability)은 트랜잭션의 안전성을 보장하며, 데이터 손실 없이 시스템의 안정성을 유지하는데 중요한 역할을 담당한다.

### 질문

#### 트랜잭션의 원자성(Atomicity)이 보장되지 않으면 어떤 문제가 발생할 수 있습니까?
- 원자성이 보장되지 않으면 트랜잭션이 부분적으로만 수행되는 문제가 발생할 수 있습니다. 예를 들어, 게시판에 글을 작성하는 트랜잭션에서 글 제목은 저장되었지만 본문은 저장되지 않는 상황이 발생할 수 있습니다. 이런 경우 사용자 경험이 나빠질 뿐 아니라 데이터 정합성이 무너집니다. 원자성은 트랜잭션의 모든 작업이 전부 수행되거나 전혀 수행되지 않아야 한다는 원칙으로, 이를 통해 이러한 문제를 방지할 수 있습니다. 개발자는 커밋/롤백 시점을 명확히 구분하고, 예외 발생 시 반드시 롤백 처리하도록 코드를 작성해야 합니다.

#### 트랜잭션에서 일관성(Consistency)과 원자성(Atomicity)은 어떻게 다르며, 각각이 어떤 역할을 하나요?
- 원자성은 트랜잭션 내의 모든 작업이 모두 성공하거나 모두 실패해야 한다는 것을 의미합니다. 즉, 트랜잭션을 수행하는 도중 일부 작업만 완료되는 상태는 허용되지 않습니다.
반면 일관성은 트랜잭션 수행 전과 후에 데이터베이스가 정의된 규칙과 제약 조건을 항상 만족하는 상태를 의미합니다. 예를 들어 제약 조건(제목 길이, 잔액 >= 0 등)을 위반하면 트랜잭션은 일관성을 보장하기 위해 실패하고 롤백됩니다.
즉, 원자성은 트랜잭션 자체의 실행 여부, 일관성은 실행 결과의 유효성을 보장합니다.

### 트랜잭션의 지속성(Durability)이 보장되지 않는다면 어떤 문제가 발생할 수 있나요?
- 지속성이 보장되지 않으면, 트랜잭션이 성공적으로 완료되어 커밋되었음에도 불구하고 시스템 장애가 발생하면 데이터 손실이 발생할 수 있습니다. 예를 들어, 주문 트랜잭션이 성공했다고 사용자에게 알려졌는데 시스템이 다운되어 주문 내역이 사라진다면 신뢰성과 서비스 안정성에 큰 문제가 됩니다.
이를 방지하기 위해 대부분의 DBMS는 커밋 시 데이터를 디스크에 기록하고, 장애 발생 시 로그를 기반으로 복구하는 메커니즘(Write-Ahead Logging 등)을 사용하여 지속성을 확보합니다.

--- 

참고링크 

https://covenant.tistory.com/85

https://velog.io/@jazzcafe12/ACID%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80