## 쿠키와 세션을 사용하는 이유
- HTTP 프로토콜의 특징이자 약점을 보완하기위해서 사용된다.
    - Connectionless 프로토콜(비연결지향)
        - 클라이언트가 서버에 요청 (Request)했을때, 그 요청 에 맞는 응답(Response)를 보낸 후 연결을 끊는 처리 방식이다.
        - HTTP 1.1버전에서 연결을 우지하고 재활용하는 기능이 Default로 추가되었다.(keep-alive값으로 변경가능)
    - Stateless 프로토콜(상태정보 유지안함)
        - 클라이언트의 상태 정보를 가지지않는 서버 처리 방식이다.
        - 클라이언트와 첫번쨰 통신에서 데이터를 주고받았다해도 두번쨰 통신에서 이전 데이터를 유지하지않는다. 하지만 실제로 웹 개발에선 데이터 유지가 필요한 경우가 많음(ex 로그인유지,장바구니 상품 구매)
    - 이러한 stateless 상태를 보완하기위해 쿠키와 세션을 사용한다. 

# Cookie 쿠키
![image](https://github.com/user-attachments/assets/ca0caae4-694e-495a-ad74-84afde1b39b2)
이미지 출처 : https://interconnection.tistory.com/74
- 클라이언트 측에 저장되는 작은 데이터 조각으로 사용자가 웹사이트를 방문할때마다 서버에 전송됨. 이를 통해 사용자의 선호도나 로그인 상태등을 기억할 수 있다. 
- 사용자가 웹사이트를 방문할때마다 서버에 의해 생성되어 사용자의 컴퓨터에 저장됨. 이후 사용자가 같은 웹사이트를 방문하면 웹브라우저는 쿠키 정보를 서버에 전송하여 사용자를 식별함.
- 쿠키는 주로 사용자의 로그인 상태 유지, 사이트 선호 설정저장, 쇼핑 카트 정보 유지등에 사용됨. 예를 들어 온라인 쇼핑몰에서 사용자가 상품을 장바구니에 담은 후 로그아웃 했다가 다시 로그인하면 장바구니에 담긴 상품이 그대로 유지되는 것은 쿠키덕분.
- 쿠키를 통해 사용자의 상품 선택 정보가 클라이언트 측에 저장되어있기때문
- 하지만 쿠키는 사용자의 컴퓨터에 직접 저장되므로 보안상의 문제가 발생할 수 있음. -> 쿠키의 정보가 악용될 가능성이 있다.
- 중요한 정보는 쿠키보다 세션을 사용하는 것이 안정적.

## 쿠키의 특징
- 이름, 값 , 만요일(저장기간 설정), 경로 정보로 구성됭어ㅣㅆ다.
- 클라이언트에 총 300개의 쿠키를 저장할 수있다.
- 하나의 도메인당 20개의 쿠키를 저장할 수 있다
- 하나의 쿠키는 4KB(=4096byte)까지 저장 가능하다.

## 쿠키의 동작 순서
- 클라이언트가 페이지를 요청한다
- 웹서버는 쿠키를 생성한다
- 생성한 쿠키에 정보를 담아 HTTP 화면을 돌려줄떄 같이 클라이언트에게 돌려준다.
- 넘겨받은 쿠키는 클라이언트가 가지고있다가(로컬 PC에 저장) 다시 서버에 요청할때 요청과 함께 쿠키를 전송한다.
- 동일 사이트 재 방문시 클라이언트의 PC에 해당 쿠키가 있는 경우, 요청 페이지와 함꼐 쿠키를 전송한다.

## 쿠키의 한계
- 유실되기 쉬움
    - 브라우저 환경 설정에서 쿠키 일괄 삭제 기능을 제공하며 웹사이트 별로도 쉽게 쿠키를 삭제할 수 있고 특정 브라우저가 하드디스크의 어느 경로에 쿠키를 저장하는지 구글링해보면 누구나 알수 있음 -> 유실 될 가능성 높음
- 변조되기 쉬움
    - 개발자 도구를 사용하면 각 웹사이트 별로 현재 어떤 쿠키가 저장되어있는지 한눈에 파악가능.**쿠키를 변경할수도 있음**
    - 심지어 서버가 브라우저로 보낸 쿠키와 전혀 다른 쿠키를 서버에 돌려보낼 수도있고 서버가 저장한적 없는 새로운 쿠키를 만들어서 서버에 돌려보낼수도있음
    - 프록시 서버를 이용해서 브라우저에서 보낸 쿠키를 중간부터 변조해서 서버에 보내는 것도 가능함.
    - 따라서 서버는 브라우저로부터 수신한 쿠키 데이터가 유효한지 검증할 필요가 있음.
- 쿠키는 도난되기 쉽다.
    - 클라이언트에 저장되어있는 쿠키가 탈취되는 것을 서버입장에서 막을 수가 없다. 클라이언트에 저장하기때문에 

# 세션 Session
- 일정 기간동안 같은 사용자(브라우저)로 부터 들어오는 일련의 요구를 하나의 상태로보고 그 상태를 일정하게 유지시키는 기술이다.여기서 일정시간 방문자가 웹브라우저를 통해 웹서버에 접속한 시점으로부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말한다. 
- 즉, **방문자가 웹서버에 접속해 있는 상태를 하나의 단위로 보고 그것을 세션이라고 한다.**
- 세션은 사용자가 웹사이트에 접속하여 로그아웃할떄까지의 시간동안 상요자의 상태를 서버에 저장하는 방법.
- 세션 ID를 통해 사용잘르 구분하며 이 ID는 쿠키를 통해 사용자의 컴퓨터에 저장될 수 있음.
- 세션은 로그인 정보, 사용자의 서버 상태 정보 등 보안이 필요한 정보를 저장하는 데 적합 예를 들어 온라인 뱅킹 사이트에서는 사용자의 로그인 상태를 세션을 통해 관리.
- 세션정보는 서버에 저장되므로 클라이언트 측에서 직접 접근할 수 없어 보안성이 높기때문'- 하지만 세션을 사용할때는 서버의 메모리를 사용하기때문에 대규모 트래픽이 발생하는 사이트에서는 세션관리가 부담될수있음.
-따라서 세션은 필요한 경우에 한정하여 적절히 관리하는게 중요

## 세션의 특징
- 웹서버에 웹 컨테이너의 상태를 유지하기위한 정보를 저장한다.
- 웹서버의 저장되는 쿠키(=세션쿠키)
- 브라우저를 닫거나 서버에서 세션을 삭제했을때만 삭제가 되므로 쿠키보다 비교적 보안이 좋다.
- 저장데이터에 제한이 없다(서버에 저장함으로)
- 각 클라이언트 고유 Session ID를 부여한다. Session ID로 클라이언트를 구분하여 각 클라이언트 요구에 맞는 서비스를 제공한다. 

## 세션의 동작 순서
- 클라이언트가 페이지를 요청
- 서버는 접근한 클라이언트의 Request-Header 필드인 Cookie를 확인하여 클라이언트가 해당 session-id를 보냈는지 확인한다.
- session-id가 존재하지않는다면, 서버는 session-id를 생성해 클라이언트에게 돌려준다.
- 서버에서 클라이언트로 돌려준 Session-id를 쿠키를 사용해 서버에 저장한다. 쿠키이름 : JSESSIONID
- 클라이언트는 이 쿠키(JSSESIONID)를 이용하여 session-id 값을 서버에 전달
    - 사용예시 : 화면이 이동해도 로그인이 풀리지않고 로그아웃까지 유지됨.

## 세션의 단점
- 서버의 메모리 부담
    - 서버의 메모리를 사용하여 데이터를 저장함. 세션데이터가 증가하면 서버의 메모리 사용량이 급격히 증가할 수 있음.
    - 특히 대규모 어플리케이션에서는 메모리 부족 문제를 야기할 수 있다.
- 확장성 문제
    - 세션은 특정 서버에 저장되므로 로드밸런서를 사용하는 경우 같은 상요자가 항상 동일한 서버에 연결되도록 유지해야한다.이를 세션 스티키라고 하며 시스템 확장을 어렵게 만들 수있다. 이를 해결하려면 Redis, Memcached같은 분산 세션 저장소를 사용해야함.
- 데이터 동기화 문제
    - 분산서버 환경에서 세션 데이터를 동기화 하려면 추가적인 구현이 필요함. 
    - 예를 들어, 서버 간에 세션 데이터를 복제하거나 외부 저장소를 이용해야 하며, 이는 애플리케이션의 복잡성을 증가시킬 수 있다.
-  보안 문제
    - 세션 ID가 유출되면 공격자가 세션을 가로채어 사용자로 가장할 수 있다 (Session Hijacking).
    - 이를 방지하기 위해 HTTPS, 세션 타임아웃, 세션 ID 재생성 등의 추가적인 보안 조치가 필요하다.


#### 세션을 말고 쿠키를 쓰는 이유가 뭘까요?
- 세션이 쿠키에 비해 보안도가 높은 편이지만 세션은 서버에 저장되고 서버 자원을 사용하기때문에 사용자가 많을 경우 소모되는 자원이 상당함. 이러한 자원관리 차원에서 퀴와 세션을 적절한 요소 및 기능에 병행 사용하여 서버 자원의 낭비를 방지하여 웹사이트 속도를 높일 수 있음.


### 질문
#### 질문 1: HTTP 프로토콜에서 쿠키와 세션이 필요한 이유는 무엇인가요?
- HTTP는 비연결지향(Connectionless) 및 무상태(Stateless) 프로토콜이므로, 클라이언트의 상태를 기억하거나 연결을 유지할 수 없습니다. 하지만 웹 애플리케이션에서는 로그인 상태 유지, 장바구니 기능 등 사용자 상태를 기억해야 하는 상황이 많습니다. 이를 해결하기 위해 쿠키와 세션이 사용됩니다.

#### 질문 2: 쿠키보다 세션이 보안상 더 유리한 이유는 무엇인가요?
- 세션은 데이터를 서버 측에 저장하므로 클라이언트에서 직접 접근하거나 변조할 수 없습니다. 반면, 쿠키는 클라이언트 측에 저장되므로 도난, 변조, 유실 가능성이 높아 보안상 더 취약합니다. 따라서 중요한 데이터는 세션을 통해 관리하는 것이 더 안전합니다.


참고링크 

https://hahahoho5915.tistory.com/32

https://www.daleseo.com/http-cookies/

https://www.daleseo.com/http-cookies/