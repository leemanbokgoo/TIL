# 톰캣 (tomCat)

- 아파치 소프트웨어 재단의 웹 어플리케이션 서버 (Web Application Server, WAS)
- 자바 서블릿을 실행시키고 JSP 코드가 포함되어있는 동적 웹페이지를 구동시켜주는 프로그램이다.
- 내장 되어있는 웹서버를 이용해 독집립적으로 사용할 수도 있음. 그러나 보통 아파치(httpd), Nginx 등의 웹서버와 함께 사용함
-  dynamic(동적)인 웹을 만들기 위한 웹 컨테이너, 서블릿 컨테이너라고 불리며, 웹서버에서 정적으로 처리해야할 데이터를 제외한 JSP, ASP, PHP 등은 웹 컨테이너(톰캣)에게 전달한다.
- 동적인 데이터 처리가 가능하고, DB연결, 데이터 조작, 다른 응용프로그램과 상호 작용이 가능하다.

#### WAS란
![image](https://github.com/user-attachments/assets/6b93ccb3-37e6-4b77-aa74-b58dd76452b8)
- WAS는 웹서버와 웹 컨테이너의 결합으로 다양한 기능을 컨테이너에 구현하여 다양한 역할을 수행할 수 있는 서버를 말함. 클라이언트 요청이 들어왔을때 내부의 프로그램을 통해 결과를 만들고 다시 클라이언트에게 전달해주는 역할을 하는 것이 웹 컨테이너

## 톰캣의 구조
- Coyote (HTTP Component) : Tomcat에 TCP를 통한 프로토콜 지원
- Catalina (Servlet Container) : 자바 서블릿을 호스팅하는 환경
- Jasper (JSP Engine) : 실제 JSP 페이지의 요청을 처리하는 Servlet
![image](https://github.com/user-attachments/assets/d6c47cd0-e0c3-4c91-adbe-138458a3a32a)

## 톰캣의 구성요소

#### 카탈리나
- 톰캣의 서블릿 컨테이너. 서블릿과 자바서버 페이지(JSP)에 대한 마이크로시스템즈의 사양을 구현
- 톰캣에서 영역 요소는 해당 사용자에게 할당된 사용자 이름, 암호 및 역할의 "데이터베이스"를 나타낸다.(유닉스 그룹과 유사함). 
- 서로 다른 영역의 구현은 카탈리나를 그러한 인증 정보가 이미 생성되고 유지되고있는 환경에 통합한 다음, 서블릿 규격에 설명된대로 컨테이너 관리 보안을 구현하는데 사용할 수 있게 한다.

#### 코요테
- 코요테는 웹서버로서 HTTP 1.1 프로토콜을 지원하는 톰캣용 커넥터 컴포넌트다. 이것은 명목상 자바 서블릿 또는 자바 서버 페이지 컨테이너인 카탈리나가 HTTP문서로서 로컬 파일을 제공하는 평범한 웹서버 역할도 할 수 있게 해줌. 코요테는 특정 TCP 포트의 서버로 들어오는 연결을 청취하고 톰캣 엔진에 요청을 전달하여 요청을 처리하고 요청 클라이언트에 응답을 다시 보낸다. 또 다른 코요테 너켁터인 코요테 JK는 비슷하게 듣지만 대신 JK프로토콜을 사용하여 아파치와 같은 다른 웹서버에 요청을 전달한다. 이것은 보통 더 나은 성능을 제공한다. 

#### 재스퍼
- 재스퍼는 톰캣의 자바 서버 페이지 엔진이다. 재스퍼는 자바 서버 페이지 파일을 구문 분석하여 서블릿으로 자바 코드를 컴파일한다. 재스퍼는 런타임에 자바 서버 페이지 파일의 변경사항을 감지하여 다시 컴파일한다. 

#### 자바 서버 페이지 태그 라이브러리 풀링
- 자바 서버 페이지 파일의 각 태그 표시는 태그 처리기 클래스에 의해 처리된다. 태그 핸들러 클래스 객체는 풀링하여 전체 자바 서버 페이지 서블릿에 재사용할 수 있다.

#### 백그라운드 자바 서버 페이지 컴파일
- 수정된 자바 서버 페이지 자바 코드를 다시 컴파일하는 동안 서버 요청에 대해 이전 버전을 계속 사용할수 있음. 이전 자바 서버 페이지 서블릿은 새로운 자바 서버 페이지 서블릿의 재 컴파일 작업이 
완료되면 삭제된다.

#### 자바 개발 도구 자바 컴파일러
재스퍼 2는 앤트와 자바대신 이클립스 자바 개발 도구(JDT, Java Development Tools) 자바 컴파일러를 사용하 ㄹ수 있다.

#### 클러스터
- 이 구성 요소는 대형 응용 프로그램을 관리하기위해 추가되었다. 그것은 많은 기법을 통해 달성할 수 있는 부하분산에 사용된다. 클러스터링 지원에는 현재 JDK 버전 1.5 이상이 필요하다.

#### 고가용성
- 실시간 환경에 영향을 주지않고 시스템 업그레이드(예: 새로운 릴리즈, 변경요청)일정을 쉽게 예약 할 수 있도록 고가용성 기능이 추가되었다. 이것은 메인서버가 메인 포트에서 업그레이드 되는 동안 다른 포트의 임시 서버에 라이브 트래픽 요청을 전송함으로서 이루어진다. 트래픽이 많은 엡 어플리케이션에서 사용자 요청을 처리하는데 매우 유용.

#### 웹 어플리케이션
- 다양한 완경 전반에 걸친 배포 지원을 추가하기위해 시스템 기반 웹 어플리케이션 개선 뿐만 아니라 사용자도 추가했다. 네트워크 전체의 애플리케이션 뿐만 아니라 세션 관리도 시도함. 아파치 톰캣과 함께 많은 추가 구성 용소를 사용하 ㄹ수 있다. 이러한 구성요소는 사용자가 필요한 경우 또는 미러 중 하나에서 다운로드 할 수 있는 경우에 제작 할 수있다. 


## 톰캣의 동작
- HTTP 요청을 Coyote에서 받아서 Catalina로 전달
- Catalina에서 전달받은 HTTP 요청을 처리할 웹 어플리케이션을 찾고 WEB-INF/web.xml 파일 내용을 참조하여 요청을 전달
- 요청된 Servlet을 통해 생성된 JSP 파일들이 호출될 때 Jasper가 Validation Check/Compile등을 수행

## 처리순서 
- HTTP request > Catalina > Context > Servlet > Response
![image](https://github.com/user-attachments/assets/e0a05c15-72fc-46d0-9d7a-36497b5f0e24)

- Tomcat은 JVM 위에서 동작.하나의 JVM에서 하나의 Tomcat Instance가 하나의 Process로 동작
- 하나의 Server에는 여러 개의 Service가 존재 가능, 각각의 Service는 1개의 Engine과 여러 개의 Connector로 구성
- Engine은 Catalina Servlet Engine이라고도 불리며, 정의된 Connector로 들어온 요청을 하위에 있는 해당 Host에게 전달해주는 역할을 수행
- 하나의 Engine에는 여러 개의 Host가 존재 가능, Host는 가상호스트 이름을 나타내며, 호스트 이름이 곧 url에 매핑
- Host에는 여러 개의 Context가 존재 가능, Context는 하나의 Web Application을 나타내며 주로 *.war 파일의 형태로 배포
- Tomcat Server가 요청을 받으면, Catalina (Tomcat Engine)가 요청에 맞는 Context (Context path)를 찾고, Context는 자신이 설정된 어플리케이션의 deployment descriptor file (web.xml)을 기반으로 전달받은 요청을 서블릿에게 전달하여 처리

## Tomcat의 디렉토리 구조
- Bin: 톰캣 서버의 동작을 제어할 수 있는 스크립트 및 실행 파일
- Conf: 톰캣의 기본적인 설정 파일
- Lib: 아파치와 같은 다른 웹 서버와 톰캣을 연결해주는 바이너리 모듈들
- Webapps: 톰캣이 제공하는 웹 애플리케이션의 기본 위치
- Logs: 서버의 로그 파일이 저장
- Work: jsp 컨테이너와 다른 파일들이 생성하는 임시 디렉토리
- Temp: 임시 저장 폴더

## Embedded Tomcat
- 톰캣은 기본적으로 Java로 개발되어 있음
- 위에서 설명한 일반적인 톰캣말고 임베디드 톰캣을 사용하면 웹 어플리케이션에 내장시켜서 어플리케이션과 동일한 JVM에서 실행이 가능
마이크로서비스에 적합
- Spring boot에서는 기본적으로 Embedded Tomcat이 포함되어 있음

## Tomcat과 Embedded Tomcat의 차이
- 성능 상 유의미한 차이 없음
- 임베디드 톰캣은 virtual host가 지원되지 않음
- 임베디드 톰캣은 WAS 설정을 웹 어플리케이션 내부에서 해야함 (Java Code, application.properties 등)
- 외장 톰캣은 xml파일로 WAS설정을 할 수 있음
- 부팅속도는 Embedded Tomcat이 좀 더 빠름

### 질문
#### 1. Tomcat의 주요 구성 요소 중 Catalina, Coyote, Jasper는 각각 어떤 역할을 하나요?
- Catalina는 톰캣의 서블릿 컨테이너로, 서블릿과 JSP를 처리하는 핵심 컴포넌트입니다. Coyote는 HTTP 1.1 프로토콜을 처리하는 커넥터로, 클라이언트 요청을 톰캣 엔진으로 전달하고 응답을 클라이언트에 돌려보내는 역할을 합니다. Jasper는 JSP 엔진으로, JSP 파일을 서블릿으로 컴파일하고 런타임에 변경 사항을 감지해 재컴파일합니다.

#### 2. Embedded Tomcat과 외장 Tomcat의 주요 차이는 무엇인가요?
- Embedded Tomcat은 애플리케이션 내부에 포함되어 동일한 JVM에서 실행되며, 마이크로서비스와 같은 독립적 환경에 적합합니다. 반면, 외장 Tomcat은 별도의 서버로 운영되며 XML 설정 파일로 쉽게 관리할 수 있습니다. 성능 차이는 거의 없지만, Embedded Tomcat은 부팅 속도가 빠르고 외장 Tomcat은 Virtual Host를 지원합니다.

----
참고링크 

https://velog.io/@hsk2454/Tomcat%EC%9D%B4%EB%9E%80

https://ko.wikipedia.org/wiki/%EC%95%84%ED%8C%8C%EC%B9%98_%ED%86%B0%EC%BA%A3