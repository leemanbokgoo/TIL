


# Apache
- 아파치 소프트워으 재단에서 만든 웹서버 프로그램이다. 모든 OS에서 실행되고 다른 유명한 소프트웨어 프로젝트와의 문서화가 잘되어있고 통합지원등의 이점이 있음.

### 특징

#### MPM(multi-process Moudule )
- 스레드/프로세스 기반 구조
- **프로세스 기반 접근 방식**으로 하나의 스레드가 하나의 요청을 처리하는 구조
- 매 요청마다 스레드를 생성 및 할당 해야하기떄문에 리소스를 많이 잡아먹음.
![image](https://github.com/user-attachments/assets/f27b47f0-370a-4a9b-a1bb-d267e83cd7d0)

- MPM은 웹 서버나 어플리케이션 서버에서 **동시성**을 관리하는 방식 중 하나. 주로 Apache HTTP 서버에서 여러 요청을 어떻게 처리할지 설정하는 방식으로 사용됨.

#### PreFork MPM(다중 프로세스)
![image](https://github.com/user-attachments/assets/048e003f-b6df-48c2-9c2b-48584f4733cc)
- client 요청이 데해 아파치 자식 프로세스를 생성하여 처리.
- 요청이 많을 경우 Process를 생성하여 처리한다. 이방식은 아파치 설치 시 default로 설정되어있음.
- 하나의 자식 프로세스 당 하나의 스레드를 갖는 구조로 자식 프로세스는 최대 1024개까지 가능.
- 스레드간의 메모리를 공유하지않음.
    - 이 방식은 독립적이기에 안정저긴 반면, 메모리 소모가 크다는 단점이 있음.
- 실행 중인 프로세스를 복제하여 실행함. -> 메모리 영역까지 복제
- 응답 프로세스를 미리 띄어놓고 클라이언트 요청 시 자식 프로세스가 반응하는 방식.
- 디버깅이 빈약한 플랫폼에서 쉬운 디버깅이 가능
- 일반적으로 Single CPU 또는 Dual CPU에서 성능이 더 좋다.

#### Worker MPM(멀티 프로세스- 스레드)
![image](https://github.com/user-attachments/assets/dcaa27ce-9d8a-4542-935a-d1d29e228935)
- Prefork 보다 메모리 사용량이 적고 동시 접속자가 많은 사이트에 적합함.각 프로세스의 스레드를 생성해 처리하는 구조
- 스레드간의 메모리 공유가 가능
- 프로세스당 최대 64개의 스레드 처리가 가능하며 각 스레드는 하나의 연결만을 부여받는다.
- 일반적으로 멀티 CPU 시스템에서 성능이 좋음

### 동적 컨텐츠 처리

### 다양한 모듈 

## 단점
- **클라이언트 접속 시 마다 프로세스 또는 스레드를 생성하는 구조**이기때문에 대량의 클라이언트(1만이상)가 접속한다면 CPU/메모리 사용량이 증가하고 프로세스.스레드 생성 비용이 드는 등 요청에 한계가 있음. -> C10K 일만개의 클라이언트 문제
- Apache 서비의 프로세스가 blocking되면 요청을 처리하지못하고 처리가 완료될떄까지 계속 대기
    - **Keep Alive**(접속대기)를 이용해 해결이 가능ㅎ아지만, Keep Alive 때문에 대량 접속 시 효율이 떨어짐.


# Nginx
- **이벤트 중심 접근 방식**으로 하나의 스레드에서 여러 요청을 처리하는 구조
- 비동기 Event-Driven 구조 : Event Handler에서 비동기 방식으로 먼저 처리되는 요청을 진행
- Apache의 C10K 문제점 해결을 위해 만들어진 Event-Driven 구조의 웹 서버 소프트웨어
- 코어 모듈이 APACHE보다 적은 리소스로도 많은 트래픽을 효율적으로 처리가능.

## 특징

#### Event-Driven 처리기반 구조 
![image](https://github.com/user-attachments/assets/d6a320ff-91f3-4cba-9a07-0e784187596a)
- 한개의 고정된 프로세스만을 생성하고 여러개의 CONNcetion을 모두 Event-Handelr를 통해 비동기 방식으로 처리
- 적은 양의 스레드만 사용되기때문에 컨택스트 스위칭 비용이 적고, CPU소모가 적음.
- Apache와 달리 동시 접속자 수가 많아져도 추가적인 생성비용이 들지않음.
- CPU와 상관없이 모든 I/O들을 전부 Event Listener로 미루기때문에 흐름이 끊기지않고 응답이 빠르게 진행되어 1개의 프로세스로 더 빠른 작업이 가능 -> 메모리를 더 작게 사용

#### 리버스 프록시로 배치가능
- NGINX의 빠른 처리 속도를 활용하여 클라이언트의 모든 요청을 처리함.

## 단점
- 동적 컨텐츠를 기본적으로 처리할 수 없음
- 외부 프로세스로 전달하고 랜더링된 컨텐츠를 다시 전송할떄가지 기다려야함. -> 프로세스 속도저하
- 아파치에 비해 다양한 모듈이 없음.


## 정리
![image](https://github.com/user-attachments/assets/4bba487c-c5f5-4741-a10e-f25433975c8e)


## 사용량

![image](https://github.com/user-attachments/assets/f474a489-52fb-47eb-a49b-aced2a7ad6e6)

- 최근에는 아파치보다 Ningx의 사용량이 더 많음. 

참고링크 

https://velog.io/@ksso730/Nginx-Apache-%EB%B9%84%EA%B5%90