# Query DSL
- DSL는 Domain Specific Language의 약자로 특정 영역에 특화된 언어를 의미한다. 그런 의미에서 QueryDsl은 쿼리 생성에 특정된 프레임워크를 의미한다.
- JPA는 객체지향 어플리케이션과 관계형 DB 사이의 패러다임 불일치를 해결하는 프레임워크이다. 개발자는 객체지향 관점으로 개발하고 JPA 프레임워크는 자동으로 SQL 쿼리문을 생성한다. SQL문이 자동으로 생성되니 개발자는 SQL관점으로 프로그래밍을 하지않아도 된다. 그러나 완전한 분리는 불가능하다. 복잡한 쿼리 생성을 위해 JPA는 JPQL을 지원한다.
- JPQL은 SQL문과 상당히 유사하다. 객체 지향점 관점을 유지하고 있는 SQL문이라고 볼수있다.

## JPQL의 문제점
- 타입 안정성이 떨어진다.
    - JPQL은 문자열이다. 문자열이기때문에 JPQL의 문법이 틀려도 이를 알아차리기 힘들다. 그래서 런타임 중에 메소드가 호출되어 JPQL이 파싱되어야만 문법오류를 발견할 수 있다. @Query 어노테이션을 사용하면 프로그램이 올라가는 과정에 문법오류를 발견할 수 있지만 이것도 결국ㄱ은 프로그램을 실행해야만 오류를 발견할 수 있다. 즉, JPQL을 파싱하는 프로세스가 동작해야하만 문법오류를 발견할 수 있고 컴파일 과정에서는 어떤 오류도 발견할 수 없다.
- 직관적인 동적 쿼리 작성이 어렵다
    - 동적 쿼리를 작성하려면 문자열을 조작하는 방식으로 로직을 구성해야한다. 그러다보니 문자열과 문자열 사이에 if-else문이나 for문같은 코드가 들어가 가독성을 떨어뜨린다.

- 이런 문제점을 해결하기위해 QueryDSL을 사용한다.

# QueryDSl 동작원리

![image](https://github.com/user-attachments/assets/9d59999e-8496-4d56-8400-ff6f59455bd1)

- 개발자가 JPQL을 문자열로 직접 작성하면, 타입 안정성을 체크 할 수 없고 직관적인 동적 쿼리도 작성할 수 없다. QueryDSL은 JPQL을 대신하여 이런 문제를 해결한다 .

![image](https://github.com/user-attachments/assets/f6e85331-2ca5-43ae-abe8-81b745cf8c4d)

- Query DSL의 목적은 JPQL의 생성이다. 개발자는 QueryDSL이 JPQL을 생성할수있도록 필요한 데이터를 세팅하여 전달해야한다. 일단 ENtitiy 정보가 필요하다. 그러나 Entity는 JPA프레임워크에서 지원하는 모듈이다. QueryDSL은 쿼리 생성에 특화된 프레임워크로 JPA 프레임워크와 분리되어있다. 그러므로 다른 프레임워크의 모듈을 그대로 사용하면 JPA 프레임워크에 종속되어버린다. 이런 현상을 막고자 QueryDsl은 Entity 정보를 담은 Q타입 클래스를 사용한다. 

- Query DSL 코드 목적은 JPQL 생성용 데이터 세팅이다. 그러므로 Query DSL은 데이터 세팅에 특화된 디자인 패턴인 빌더 패턴구조로 이루어져있다. 이런 메소드들이 파이프 라인 구조로 되어있어 가독성도 올라간다.


### 질문
#### 1. QueryDSL이 JPQL의 동적 쿼리 작성 문제를 어떻게 해결하는가?
-  QueryDSL은 빌더 패턴을 통해 직관적이고 가독성 높은 방식으로 동적 쿼리를 작성할 수 있게 해줍니다. JPQL은 문자열로 쿼리를 구성하기 때문에 조건이 추가될 때마다 문자열을 조작하거나 복잡한 조건문을 추가해야 합니다. 반면, QueryDSL에서는 Q타입 클래스와 메서드 체이닝을 사용하여 조건에 따라 쿼리를 유연하게 작성할 수 있습니다. 예를 들어, 조건부 필터링이 필요한 경우 BooleanBuilder를 사용하여 조건에 따라 필터를 추가할 수 있으며, 코드의 가독성과 유지보수성이 높아집니다. QueryDSL의 빌더 패턴은 데이터 세팅에 적합하며, 복잡한 동적 쿼리를 쉽게 구성할 수 있게 도와줍니다.
#### 2. QueryDSL이 JPQL의 타입 안전성 문제를 어떻게 해결하는가?
- QueryDSL은 타입 안전한 쿼리 작성을 지원하여 JPQL의 타입 안정성 문제를 해결합니다. JPQL은 문자열로 쿼리를 작성하기 때문에, 잘못된 문법이나 필드명을 컴파일 시점에 확인할 수 없습니다. 그러나 QueryDSL에서는 Q타입 클래스를 사용하여 엔티티의 필드와 메서드를 직접 참조하게끔 하므로, 잘못된 필드명을 사용할 경우 컴파일 시점에 오류가 발생합니다. 이를 통해 QueryDSL은 JPQL이 가지는 런타임 오류 발생 위험을 줄이고, 더 안전한 코드 작성을 가능하게 해줍니다.



참고링크 

https://lordofkangs.tistory.com/456

https://velog.io/@soyeon207/QueryDSL-%EC%9D%B4%EB%9E%80