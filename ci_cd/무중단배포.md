## 무중단배포
- 시스템의 업데이트나 배포 과정에서 서비스의 중단 없이 새로운 버전을 배포하는 방법으로 사용자에게 서비스를 계속 제공하면서 시스템을 업데이트할 수 있는 방법을 제공하여 가용성과 신뢰성을 높인다. 
- 서비스를 운영 중일 때 새로운 버전을 배포하기 위해서는 기존의 서비스를 종료하고 새로운 서비스를 시작하는 과정이 필요하다. 이렇게 서비스가 중단되는 시간, 즉 시스템을 이용할 수 없는 시간을 다운타임(Downtime)이라고 한다. 운영 중인 서비스가 중단되어 이용할 수 없다는 것은 큰 문제임으로 이를 해결할 수 있는 방법이 바로 무중단 배포이다.

## 무중단 배포 특징
### 서버는 최소 두 개 이상 존재
- 서버를 배포하기 위해서는 결국에 잠깐이라도 서비스 중인 서버가 내려가고 다시 서버가 동작하는 시간 즉, downtime이 필요하기 때문에 절대 단일 서버로 무중단 배포 시스템을 구축할 수 없다.

### 로드밸런서가 필요하다.
- 먼저, 프론트엔드 단과 백엔드 단이 직접적으로 연결되어 있다고 보자. 무중단 배포를 위해, 프론트엔드 단에서는 모든 서버에 대한 각각의 IP를 알고 있어야하고 이 서버들 중 어떤 서버가 현재 사용 가능한지 찾아 그 서버에 요청을 날려야 한다. 또한, 트래팩에 대한 정보가 일괄적으로 관리되지 않아, 유동적인 트래픽 관리도 불가능해 배포 과정에서 서비스가 정상적으로 운영될 수 있는지 확인도 어렵다. 따라서 서버 앞 단에 로드밸런서를 둬서 클라이언트 요청을 받아서 처리하는 환경을 구성한다.

## 무단 배포 방식 (배포 전략 종류)

## 롤링 Rolling 

![Image](https://github.com/user-attachments/assets/686fddef-1b09-4c08-ae9e-b70053cd52c8)

- Rolling 배포는 사용 중인 인스턴스들에 새 버전의 서비스를 점진적으로 배포하는 방법으로 무중단 배포의 가장 기본적인 방식이다. 서비스 중인 인스턴스 하나를 로드 밸런서에서 라우팅하지 않도록 한 뒤, 새로운 버전의 서비스를 적용하여 다시 라우팅하도록 한다. 이를 반복해 모든 인스턴스에 새 버전의 서비스를 배포한다.
- 기존 운영중인 서버 중 일부 단위만큼씩 새 버전으로 점진적으로 교체하는 방식이다. 하지만, 그 동안 가용 가능한 서버 자원이 줄어들기 때문에, 서버 자원이 충분한지 확실한 검증 하에 진행되어야 한다. 또한, 구 버전과 신 버전이 같이 서비스되기 때문에 호환성 검증도 필요하다.

### Rolling 장점
- 인스턴스마다 차례로 배포를 진행하기 때문에 에러 등 이슈 발생 시 쉽게 롤백 가능하다.
- 기존의 인스턴스에 추가적인 인스턴스를 늘리지 않아도 된다.
- 관리에 용이하다.

### Rolling 단점
- 새 버전을 배포할 때 라우팅되어 있는 인스턴스의 수가 감소하기 때문에(배포동안 가용 가능한 서버 자원 감소) 정상 동작 중인 인스턴스에 트래픽이 몰릴 수 있다.
- 라우팅되어 있는 인스턴스들의 서비스 처리 용량을 고려해야 하는 이유이다.
- 배포가 진행될 때 기존의 버전과 새로운 버전이 함께 존재하기 때문에 호환성 문제가 발생할 수 있다. 구 버전과 신 버전의 호환성 확인 필요하다.

### Rolling 사용 사례 
- 롤링 배포는 서버나 인스턴스가 여러 개로 분리되어 있고, 점진적으로 배포하면서 시스템의 가용성을 유지하고자 할 때 유용하다. 마이크로서비스 환경, 클러스터 기반 시스템에서 유용하게 사용된다. 특히 API 서비스나 클라우드 네이티브 애플리케이션에서 효율적으로 사용할 수 있다.
- 배포가 안정적이어야 하는 서비스 : 안정성과 중단 없는 서비스 제공이 중요한 서비스에서 사용된다. 예를 들어, 전자상거래 플랫폼에서 구매 기능을 업데이트할 때, 사용자가 계속해서 서비스를 이용할 수 있도록 롤링 배포를 사용할 수 있다.
- 서버 수가 많고, 하나씩 업데이트해도 괜찮은 상황 : 여러 서버가 있는 환경에서, 각각의 서버를 독립적으로 업데이트하면서 전체 시스템이 중단되지 않도록 할 때 적합하다.
- 버전 간 호환성이 잘 보장될 때 : 새 버전이 기존 버전과 호환되도록 설계되어야 하며, 서버 간에 변경 사항이 동기화되도록 해야한다. 예를 들어, API의 스키마 변경이 없거나 기능 변경이 양방향 호환될 때 롤링 배포가 효과적이다.
- 실제 사용 사례는 다음과 같다.
    - AWS EC2 클러스터: 여러 EC2 인스턴스를 운영하면서 한 인스턴스씩 롤링 배포를 통해 새 버전을 적용한다. 트래픽은 자동으로 새로운 버전이 배포된 인스턴스로 전달된다.
    - Microservices Architecture: 여러 마이크로서비스로 구성된 시스템에서 각 마이크로서비스를 개별적으로 롤링 배포한다. 하나의 서비스만 새 버전으로 교체되고 나머지 서비스는 기존 버전을 계속 사용하므로 전체 시스템의 가용성이 유지된다.

## Blue Green 

![Image](https://github.com/user-attachments/assets/45a27902-641b-4bb0-b917-2722f0f0e8c6)

- Blue는 기존 버전, Green은 새로 배포될 버전을 의미한다. 신 버전을 배포하고 일제히 전환하여 모든 연결이 신 버전을 바라보게 하는 전략이다. 운영 중인 구 버전과 동일한 신 버전의 인스턴스를 나란히 구성한 후 배포 시점에 로드 밸런서를 통해 모든 트래픽이 일제히 전환된다.
- 한꺼번에 모든 서비스를 전환하기 때문에, 신 버전이 정상적으로 동작하는지에 대한 테스트가 진행되어야 한다. 다만, 일반적인 배포 방식보다 서버 자원을 두 배로 유지해야 한다는 단점이 있다.

### Blue Green 장점
- 구 버전의 인스턴스가 그대로 남아있어서 빠른 롤백이 가능하다.
- 운영 환경에 영향을 주지 않고 새 버전 테스트가 가능하다. 구 버전과 신 버전에 대한 호환성 확인이 필요없다.
- 구 버전의 환경을 다음 배포에 재사용할 수 있다.

### Blue Green 단점
- 시스템 자원이 두 배로 필요해 비용이 더 많이 발생한다.
- 신 버전에 대한 테스트 선행 필요하다.

### Blue Green 사용 사례 
- 블루-그린 배포는 시스템 가용성이 중요하고, 전체 트래픽을 한 번에 새로운 버전으로 전환할 때 필요할 유용하다. 빠르고 안전한 롤백이 가능하며, 대규모 변경을 한 번에 처리할 때 적합하다. 예를 들어, 금융 시스템, 대규모 전자상거래 서비스 등에서 사용된다.
- 안정성과 무중단 배포가 중요한 서비스 : 블루-그린 배포는 배포 전환 과정에서 중단 없이 서비스를 제공할 수 있기 때문에 24시간 서비스가 필요한 웹 애플리케이션이나 고객의 서비스 중단이 허용되지 않는 경우에 적합하다.
- 빠른 롤백이 필요한 상황 : 새로운 버전에서 문제가 발생했을 경우, 신속하게 롤백할 수 있어 안정성을 우선시하는 서비스에서 유리하다.
- 전면적인 환경 전환이 필요한 경우 : 시스템을 완전히 새로운 버전으로 교체해야 할 때 유용하다. 예를 들어, 대규모 아키텍처 변경이나 API 버전 업데이트와 같은 경우에 적합하다.
- 실제 사용 사례는 다음과 같다. 
    - 전자상거래 플랫폼의 안정성 : 사용자가 온라인 쇼핑 중 구매를 완료하는 과정에서 시스템이 다운되면 큰 문제가 될 수 있다. 블루-그린 배포를 사용하여 시스템을 중단 없이 새로운 버전으로 전환할 수 있으며 만약 문제가 생기면 기존 환경으로 롤백할 수 있어 안정성을 보장한다.
    - 금융 서비스 : 고객 데이터 보호와 서비스 중단 방지가 매우 중요하다. 블루-그린 배포를 통해 새로운 기능을 점진적으로 배포하고, 문제가 생길 경우 빠르게 이전 버전으로 복구할 수 있다.
    - 대규모 API 시스템 : API 버전 업그레이드 시 기존 API와 새로운 API가 충돌할 수 있다. 블루-그린 배포를 통해 기존의 API를 계속 제공하면서 새로운 API로의 전환을 원활하게 진행할 수 있다.


## Canary

![Image](https://github.com/user-attachments/assets/659b93c3-8d2a-47e9-ab12-c5c794a3acb8)

- Canary의 사전적 의미에는 카나리아라는 새가 있다. 이 새는 유독가스에 민감해 옛날 광부들이 광산에서 가스 누출 위험을 감지하는 용도로 사용했다고 한다.
- 여기서 유래한 카나리 배포 또한 잠재적 문제 상황을 미리 발견할 수 있는 배포 전략이다. 지정한 서버 또는 특정한 유저에게만 배포했다가 정상적이면 전체를 배포한다. 서버의 트래픽을 일부 신 버전으로 분산시켜서 오류 여부를 확인할 수 있는 것이다. 블루 그린 배포와 유사한 듯 보이지만, 블루 그린과 같이 트래픽을 한 번에 바꾸는 것이 아니라, 단계적으로 전환한다.
- 롤링 배포와 블루-그린 배포를 합쳐놓은 배포 방식으로 신 버전의 비율을 유동적으로 늘려가는 롤링 배포 + 실제 환경에서 미리 테스트 진행하는 블루-그린 배포 방식이다. 위험을 빠르게 감지할 수 있는 배포 전략으로, 지정한 서버 또는 특정 사용자에게만 배포했다가 정상적으로 작동하면 전체를 배포한다. 서버의 트래픽의 일부를 신 버전으로 분산시켜 오류 여부를 확인할 수 있다. 이런 전략은 A/B 테스트가 가능하며, 성능 모니터링에 유용하다. 트래픽을 분산시킬 때에는 라우팅을 랜덤하게 혹은 사용자로 분류 가능하다.

### Canary 장점
- 문제 상황을 빠르게 감지할 수 있어, 성능 모니터링에 유용하다.
- A/B 테스트가 가능하다.
    - A/B 테스트 : 대조군과 실험군으로 나누어서 특정한 UI나 알고리즘의 효과를 비교하는 방법론

### Canary 단점
- 네트워크 트래픽 제어에 부담이 될 수 있다.

### Canary 사용사례
- 카나리아 배포는 점진적으로 배포하면서 사용자 피드백을 기반으로 위험을 최소화하려는 경우에 유용하다. 소셜 미디어 서비스나 게임 서비스처럼 피드백을 실시간으로 받고, 점진적으로 롤아웃하고자 할 때 적합하다. 실시간 데이터 시스템에서도 유용할 수 있다.
- 새로운 기능 또는 큰 변경 사항이 포함된 배포 : 새 기능이나 변경 사항이 시스템에 큰 영향을 미칠 가능성이 있을 때 유용하다. 예를 들어, 새로운 결제 시스템을 추가하는 경우, 대규모 사용자 영향을 최소화하기 위해 카나리아 배포를 사용하여 문제를 빠르게 감지하고 해결할 수 있다.
- 배포 후 실시간 피드백을 받고 싶을 때: 새 버전에서 예상치 못한 버그나 성능 문제가 발생할 수 있으므로, 적은 수의 사용자에게만 배포하여 실시간 피드백을 받고 개선할 수 있다.
- 사용자 기반이 다양할 때: 다양한 사용자가 있는 서비스에서는 일부 사용자만 새로운 버전을 사용하게 하고, 문제가 없을 경우 점차적으로 배포 범위를 확장할 수 있다. 예를 들어, 소셜 미디어 서비스에서 새로운 알고리즘을 실험할 때 사용된다.
- 실제 사용 사례 
    - Google: 새로운 검색 알고리즘을 적용하기 위해 카나리아 배포 방식을 사용한다. 일부 사용자에게만 새로운 알고리즘을 적용하고, 그 결과를 분석한 후 점차적으로 전체 사용자에게 적용한다.
    - Netflix: 새로운 기능을 테스트할 때 카나리아 배포를 사용해 일부 사용자에게만 적용하고 이들의 반응을 확인한 후에 전체 사용자에게 배포한다.


### 질문
#### 무중단 배포를 위해 왜 로드밸런서가 반드시 필요한가요?
- 무중단 배포에서는 서비스가 중단되지 않고 새로운 버전으로 교체되어야 하기 때문에, 사용자 요청을 유동적으로 분산하고 제어할 수 있는 로드밸런서가 필수입니다. 로드밸런서는 각 서버의 상태를 모니터링하며, 배포 중인 서버는 트래픽에서 제외시키고, 배포 완료된 서버에만 트래픽을 보낼 수 있게 해줍니다.
예를 들어, 롤링 배포에서는 특정 인스턴스를 배포할 때 해당 인스턴스를 로드밸런서에서 제외시킨 후 새 버전을 반영하고, 완료되면 다시 등록합니다.
이처럼 로드밸런서 없이 직접 클라이언트가 서버를 제어하려고 하면, 각 서버의 상태나 트래픽 분산을 실시간으로 관리할 수 없어 무중단 배포가 사실상 불가능해집니다.

#### 롤링 배포와 블루-그린 배포의 주요 차이점은 무엇인가요?
- 롤링 배포는 기존 서버를 하나씩 업데이트하면서 점진적으로 새로운 버전으로 교체하는 방식입니다. 서버 자원이 적을 때 유리하고, 점진적으로 반영되어 리스크가 낮고 롤백이 용이합니다. 하지만 배포 도중 구버전과 신버전이 혼재되기 때문에 버전 간 호환성 이슈가 발생할 수 있습니다.반면, 블루-그린 배포는 기존 서버(Blue)와 동일한 새 서버(Green)를 미리 구축한 뒤, 한 번에 전체 트래픽을 전환합니다. 테스트 후 문제가 없으면 전환하므로 호환성 이슈가 없고, 빠르게 롤백 가능합니다. 다만, 두 배의 자원이 필요하여 비용 부담이 크다는 단점이 있습니다.요약하면, 롤링은 자원 효율적이고 점진적, 블루-그린은 자원은 더 들지만 안전하고 빠른 전환이 가능한 방식입니다.

---

참고링크 

https://digitalbourgeois.tistory.com/231

https://hoehen-flug.tistory.com/53

https://velog.io/@eeeasy-code/%EB%B0%B0%ED%8F%AC-%EC%A0%84%EB%9E%B5-%EC%A2%85%EB%A5%98-%EB%A1%A4%EB%A7%81-%EB%B8%94%EB%A3%A8-%EA%B7%B8%EB%A6%B0-%EC%B9%B4%EB%82%98%EB%A6%AC

https://olrlobt.tistory.com/92