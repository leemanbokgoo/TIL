# 8.3 POJO 프로그래밍
-  스프링의 핵심 개발자들이 함께 쓴  Professional Spring Framework라는 책이 있다. 이 책에서 스프링 핵심 개발자들은 “스프링의 정수(essence)는 엔터프라이즈 서비스 기능을 POJO에 제공하는 것” 이라고 했다.
- 분리됐지만 반드시 필요한 엔터프라이즈 서비스 기술을 POJO 방식으로 개발된 애플리케이션 핵심 로직을 담은 코드에 제공한다는 것이 스프링의 가장 강력한 특징과 목표다.

## 8.3.1 스프링의 핵심: POJO
- 스프링 애플리케이션은 POJO를 이용해서 만든 애플리케이션 코드와, POJO가 어떻게 관계를 맺고 동작하는지를 정의해놓은 설계정보로 구분된다. 스프링의 주요 기술인 IoC/DI, AOP, PSA(Portable Service Abstraction)는 애플리케이션을 POJO로 개발할 수 있게 하는 가능기술(enabling technology)이라고 불린다.

## 8.3.2 POJO란 무엇인가?
- POJO (Plain Old Java Object) : 자바의 단순한 객체를 이용해 애플리케이션의 비즈니스 로직을 구현하는 것

## 8.3.3 POJO의 조건
- 특정 규약에 종속되지 않는다. 
    - POJO는 자바 언어와 꼭 필요한 API 외에는 종속되지 않아야 한다. 특정 규약을 따라 비즈니스 컴포넌트를 만들어야 하는 경우는 POJO가 아니다.
    - 별다른 가치를 주지도 못하는 규약따위에 종속되지 않아야 하고, 객체지향 설계의 자유로운 적용이 가능한 객체여야만 POJO라고 불릴 수 있다.
- 특정 환경에 종속되지 않는다.
    - 특정 환경에 종속적이어야만 동작하는 객체도 POJO라고 할 수 없다.
    - 특히 비즈니스 로직을 담고 있는 POJO 클래스는 웹이라는 환경정보나 웹 기술을 담고 있는 클래스나 인터페이스를 사용해서는 안 된다.
    - POJO는 객체지향적인 자바 언어의 기본에 충실하게 만들어져야 한다. 책임과 역할이 각기 다른 코드를 한 클래스에 몰아넣어 덩치 큰 만능 클래스로 만드는 경우, 재사용이 불가능할 정도로 다른 레이어와 영역의 코드와 강한 결합을 가지고 만들어지는 경우, 상속과 다형성의 적용으로 처리하면 깔끔한 것을 if/switch 문이 가득 찬 길고 긴 메서드로 작성해놓은 경우라면 과연 그것이 객체지향적인 자바객체라고 할 수 있을지 의문이다

- 진정한 POJO란 객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 객체를 말한다. 그런 POJO에 애플리케이션의 핵심 로직과 기능을 담아 설계하고 개발하는 방법을 POJO 프로그래밍이라고 할 수 있다.

## 8.3.4 POJO의 장점
- 특정한 기술과 환경에 종속되지 않는 객체는 그만큼 깔끔한 코드가 될 수 있다. 로우레벨의 기술과 환경에 종속적인 코드가 비즈니스 로직과 함께 섞여 나오는 것만큼 지저분하고 복잡한 코드도 없다. 그런 코드는 개발하기도 힘들고, 오류를 찾고 디버깅하기는 더더욱 힘들다. 코드를 읽고 이해하기도 어려울뿐더러 검증이나 테스트 작성에도 한계가 있으므로 유지보수는 큰 부담이 된다.
- 또 POJO로 개발된 코드는 자동화된 테스트에 매우 유리하다.
- 객체지향적인 설계를 자유롭게 적용할 수 있다는 것도 큰 장점이다. 자바 언어의 객체지향적인 설계와 구현 방식이야말로 그 어떤 새로운 기술과 환경, 툴보다 더 실제 프로젝트를 성공시키는 데 중요한 요소임을 알고 있기 때문이다.

## 8.3.5 POJO 프레임워크
- POJO 프로그래밍이 가능하도록 기술적인 기반을 제공하는 프레임워크를 POJO 프레임워크라고 한다.
- 스프링은 엔터프라이즈 애플리케이션 개발의 모든 영역과 계층에서 POJO 방식의 구현이 가능하게 하려는 목적으로 만들어졌다.
- 스프링은 비즈니스 로직의 복잡함과 엔터프라이즈 기술의 복잡함을 분리해서 구성할 수 있게 도와준다. 하지만 자신은 기술영역에만 관여하지 비즈니스 로직을 담당하는 POJO에서는 모습을 감춘다.
- 스프링을 사용하더라도 객체지향 분석과 설계에 대한 지식을 습득하고 훈련해야 한다. 당연히 자바 언어와 JVM 플랫폼 그리고 JDK API의 사용법도 잘 알아야 한다. 디자인 패턴과 구현 패턴, 좀 더 나은 코드 구조를 만들기 위한 리팩토링 기술 또한 필요하다. 스프링을 사용한다고 해서 이런 부담이 줄어드는 건 아니다. 대신 스프링은 개발자들이 복잡한 엔터프라이즈 기술보다는 이러한 객체지향적인 설계와 개발의 원리에 좀 더 집중할 수 있도록 기회를 준다.
- 동시에 스프링이 제공하는 기술과 프레임워크 API 및 확장 포이트는 그것을 이용하는 코드가 자연스럽게 객체지향적인 설계원리를 따라가도록 이끌어주기도 한다.

# 8.4 스프링의 기술
- 기술이나 비즈니스 로직을 분리하고 POJO 방식의 애플리케이션 개발을 가능하게 한다는 스프링의 목적을 쉽게 이루려면 스프링과 같은 POJO 프레임워크가 필요하다.
- 스프링에서는 POJO 프로그래밍을 손쉽게 할 수 있도록 지원하는 세 가지(IoC/DI, AOP, PSA) 가능기술(enabling technology)을 제공한다.
- 이 세 가지 모두 스프링이 있기 이전에도 여러 가지 형태로 시도됐고 발전하고 있었던 기술이지만 스프링은 그것을 통일성 있게, 더 세련된 방법으로, 자바 엔터프라이즈 개발의 전 영역에 걸쳐 효과적으로 적용될 수 있도록 프레임워크 형태로 제공하고 있다.

## 8.4.1 제어의 역전(IoC)/의존관계 주입(DI)
- 왜 두 개의 객체를 분리해서 만들고, 인터페이스를 두고 느슨하게 연결한 뒤, 실제 사용할 대상은 DI를 통해 외부에서 지정하는 것일까? 이렇게 DI 방식으로 하는 것이 그렇지 않은 경우, 즉 직접 자신이 사용할 객체를 new 키워드로 생성해서 사용하는 강한 결합을 쓰는 방법보다 나은 점은 무엇일까?
- 가장 간단한 답변은 ‘유연한 확장이 가능하게 하기 위해서’라고 할 수 있다. DI는 개방폐쇄원칙이라는 객체지향 설계 원칙으로 잘 설명될 수 있다. 유연한 확장이라는 장점은 OCP의 ‘확장에는 열러 있다’에 해당한다. DI는 역시 OCP의 ‘변경에는 닫혀 있다’라는 말로도 설명이 가능하다. 폐쇄 관점에서 볼 때 ‘재사용이 가능하다’라고 볼 수 있다.
- A→B라는 의존관계를 갖는 객체 구조라고 생각해보자. 여기서 확장은 B가 자유롭게 변경될 수 있음을 의미한다. 이는 B가 변경돼도 A는 아무런 영향을 받지 않고 그대로 유지 가능하다는 뜻이기도 하다. B 관점에서는 유연한 확장이고 A 관점으로 보자면 (B가 바뀌어도) 변경 없이 재사용이 가능하다고 볼 수 있는 것이다.

### DI의 활용 방법
- 핵심기능의 변경
    - DI의 가장 대표적인 적용 방법은 바로 의존 대상의 구현을 바꾸는 것이다. 디자인 패턴의 전략 패턴을 활용한다. A→B 구조에서 A의 기능 일부를 B에게 위임한다고 했을 때 B의 구현 방식을 필요에 따라 통째로 B1, B2, B3로 바꾸는 것이다.
- 핵심기능의 동적인 변경
    - 첫번째랑 비슷하게 의존 객체의 핵심기능 자체를 바꾸는 것이다. 
    - 동적인 방식으로 연결되지만 한번 DI되면 바뀌지 않는 정적인 관계를 맺어주는 것이다.
    - 핵심기능을 런타임 시에 조건에 따라 다르게 처리하는 방법도 적용할 수 있다. 
- 부가기능의 추가
    - 핵심기능은 그대로 둔 채로 부가기능을 추가하는 데코레이터 패턴을 활용하는 방법이 있다. 데코레이터 패턴을 통해 핵심기능과 클라이언트 코드에는 전혀 영향을 주지 않으면서 부가기능을 얼마든지 적용할 수 있다. 부가 기능의 추가 방식을 특정 객체가 아니라 좀 더 많은 대상으로 일반화해서 적용하면 AOP가 된다.
    - 트랜잭션을 부여했던 것이 그 대표적인 예다. 부가기능을 추가할 수 있는 것도 DI 덕분이다.
- 인터페이스의 변경
    - 사용하려는 객체가 클라이언트와 호환되지 않는 경우 또는 여러 종류의 인터페이스를 가졌지만 사실은 비슷한 기능을 담당하는 객체를 바꿔가면서 사용하고 싶은 경우 어댑터 패턴을 응용해 볼 수 있다. 클라이언트가 사용하는 인터페이스와 실제 객체 사이에 인터페이스가 일치하지 않는 경우에도 DI가 유용하다.
    - DI의 응용 방법 중 하나이자 스프링의 대표적인 기술로도 분류되는 일관성 있는 서비스 추상화(PSA)가 그런 방법이다. PSA는 클라이언트가 일관성 있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 객체를 이용하게 해준다. 
- 프록시
    - 필요한 시점에서 실제 사용할 객체를 초기화하고 리소스를 준비하게 해주는 지연된 로딩을 적용하려면 프록시가 필요하다. 원격 객체를 호출할 때 마치 로컬에 존재하는 객체처럼 사용할 수 있게 원격 프록시를 적용하려고 할 때도 프록시가 필요하다. 두가지 방법 모두 DI를 필요로 한다.
- 템플릿과 콜백
    - 템플릿/콜백 패턴은 DI의 특별한 적용 방법이다. 반복적으로 등장하지만 항상 고정적인 변하지 않는 작업 흐름과 그 사이에서 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면 지저분하게 매번 만들어야 하는 코드를 간결하게 만들 수 있다. 템플릿은 한 번 만들어두면 콜백이 바뀌어도 재사용할 수 있다는 기능의 확장에도 변하지 않는다는 OCP의 폐쇄 원칙에도 잘 들어맞는다.
- 싱글톤과 객체 스코프
    - DI가 필요한 중요한 이유 중 한가지는 DI할 객체의 생명주기를 제어할 수 있다는 것이다. DI를 프레임워크로 이용한다는 건 DI 대상 객체를 컨테이너가 관리한다는 의미다.
    - 가장 기본이 되는 스코프는 역시 싱글톤이다.
    - 전통적인 싱글톤 패턴은 객체에 많은 제약을 가해서 만들어지기 때문에 컨테이너에서 생성하고 관리하는 싱글톤 빈은 매우 유용하다.
- 테스트
    - 여타 객체와 협력해서 동작하는 객체를 효과적으로 테스트하는 방법은 가능한 한 고립시키는 것이다. DI를 활용하면 테스트를 위한 클라이언트 코드의 변경 없이 의존 객체를 의도한 대로 자유롭게 제어해서 효과적으로 테스트를 진행할 수 있다.

## 8.4.2 에스펙트 지향 프로그래밍(AOP)
- 스프링의 목적인 POJO만으로 엔터프라이즈 애플리케이션을 개발하면서도 엔터프라이즈 서비스를 선언적으로 제공하는 데 반드시 필요한 것이 바로 이 AOP 기술이다.

### AOP의 적용 기법
- 첫번째는 스프링과 같이 다이내믹 프록시를 사용하는 방법이다.
- 두번째는 AspectJ와 같이 자바 언어의 한계를 넘어 언어의 확장을 이용하는 방법이다.

### AOP의 적용단계
- AOP는 하나의 모듈이 수많은 객체에 보이지 않게 적용되기 때문에 매우 주의해서 사용해야 한다.
- AOP 적용 1단계: 미리 준비된 AOP 이용
    - 스프링이 직접 제공하는 대표적인 AOP는 바로 트랜잭션이다.
    - @Configurable 어노테이션을 이용해서 도메인 객체에 DI를 자동적용해주는 AOP 기능이다.
- AOP 적용 2단계: 전담팀을 통한 정책 AOP 이용
    - 애플리케이션 전체적으로 적용가능한 것을 소수의 AOP 담당자 관리하에 적용해볼 수 있다. 대표적으로 비즈니스 로직을 가진 객체에 대한 보안, 특정 계층의 객체 이용 전후의 작업 기록을 남기는 로깅, 데이터 추적을 위한 트레이싱, 특정 구간의 실시간 성능 모니터링 같은 정책적으로 적용할 만한 기능에 AOP를 이용하는 것이다.
    - 특정 모듈을 호출하는 클라이언트를 제한한다 던지, 특정 계층에서 던질 수 있는 예외를 제한하도록 하는 목적으로도 사용될 수 있다.
    - 물론 개발이 끝나고 실전에 적용할 때는 정책 검증을 위한 AOP 설정을 간단히 제거할 수도 있다.
- AOP 적용 3단계: AOP의 자유로운 이용

## 8.4.3 포터블 서비스 추상화(PSA)
- 환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해주는 PSA(Portable Service Abstraction)이다.
- 특정 환경과 기술에 종속적이지 않다는 게 그런 기술을 사용하지 않는다는 뜻은 아니다. 다만 POJO 코드가 그런 기술에 직접 노출되어 만들어지지 않는다는 말이다.
- 어떤 경우에는 AOP나 템플릿/콜백 패턴과 결합돼서 사용되기 떄문에 직접적으로 추상화된 서비스를 사용할 필요가 없을 대도 있다. (어노테이션 기반 트랜잭션을 사용하면 추상화된 트랜잭션 서비스를 직접 사용할 필요가 없다)
- 스프링의 서비스 추상화의 개념과 장점을 잘 이해한다면 때에 따라 직접 서비스 추상화 기법을 적용할 필요도 있다.
- 서비스 추상화는 단지 구체적인 기술에 종속되지 않게 하기 위해서만 사용되는 건 아니다. 테스트가 어렵게 만들어진 API나 설정을 통해 주요 기능을 외부에서 제어하게 만들고 싶을 때도 이용할 수 있다.

# 8.5 정리
- 스프링은 그 개발철학과 목표로 분명히 이해하고 사용해야 한다.
- 스프링은 오픈소스 소프트웨어이며, 애플리케이션 개발의 모든 기술과 영역을 종합적으로 다루는 애플리케이션 프레임워크다.
- 엔터프라이즈 애플리케이션 개발의 족잡함은 비즈니스 로직과 엔터프라이즈 시스템의 기술적인 요구에 의해 발생한다. 기존의 접근 방법은 이 복잡도를 낮추지 못하며 자바의 객체지향적인 장점을 포기해야 한다는 문제점이 있다.
- 자바의 근본인 객체지향적인 원리에 충실하게 개발할 수 있으며, 환경과 규약에 의존적이지않은 POJO를 이용한 애플리케이션 개발은 엔터프라이즈 시스템 개발의 복잡함이 주는 많은 문제를 해결할 수 있다.
- 스프링의 목적은 이런 POJO를 이용해 엔터프라이즈 애플리케이션을 쉽고 효과적으로 개발할 수 있도록 지원해주는 데 있다.
- POJO 방식의 개발을 돕기 위해 스프링은 IoC/DI, AOP, PSA와 같은 기능기술을 프레임워크와 컨테이너라는 방식을 통해 제공한다.

